{% extends 'base.html' %}

{% block content %}
<h1 class="mb-4">가입된 사용자 목록 (관리자 전용)</h1>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Username</th>
      <th scope="col">Role</th>
      <th scope="col">Plan</th> <th scope="col">등급 변경</th> <th scope="col">작업</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <th scope="row">{{ user.id }}</th>
      <td>{{ user.username }}</td>
      <td>{{ user.role }}</td>
      <td>
        {% if user.plan == 'premium' %}
          <span class="badge bg-success">Premium</span>
        {% else %}
          <span class="badge bg-secondary">Basic</span>
        {% endif %}
      </td>
      <td>
        <form action="{{ url_for('main.update_plan', user_id=user.id) }}" method="post" class="d-flex">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <select name="plan" class="form-select form-select-sm me-2">
            <option value="basic" {% if user.plan == 'basic' %}selected{% endif %}>Basic</option>
            <option value="premium" {% if user.plan == 'premium' %}selected{% endif %}>Premium</option>
          </select>
          <button type="submit" class="btn btn-primary btn-sm">변경</button>
        </form>
      </td>
      <td>
        <form action="{{ url_for('main.delete_user', user_id=user.id) }}" method="post" onsubmit="return confirm('정말로 {{ user.username }} 사용자를 삭제하시겠습니까?');">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-danger btn-sm">삭제</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
